# 전송 계층 : 신뢰할 수 있는 데이터 전송하기

### OSI모델 4계층인 전송 계층의 이해
* 전송계층의 역할
* 연결형 통신과 비연결형 통신
* TCP
* UDP

## 1) 전송계층의 역할
물리 계층, 데이터 링크 계층, 네트워크 계층이 있으면 목적지에 데이터를 보낼 수 있지만 데이터가 손상되거나 유실되더라도 이들 계층에서는 아무것도 해주지 않는다.

전송계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요하다.

how? 

1) 전송 계층에서는 오류를 점검하는 기능이 있다. 오류가 발생하면 데이터를 재전송하도록 요청한다.
2) 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능

## 2) 연결형 통신과 비연결형 통신
연결형 통신 : 신뢰할 수 있고 정확한 데이터를 전달하는 통신

비연결형 통신 : 효율적으로 데이터를 전달하는 통신

전송 계층의 연결형 통신 프로토콜에는 TCP가 사용되고, 비연결형 통신 프로토콜에는 UDP가 사용된다.
    
    TCP
    Transmission Control Protocol(전송 제어 프로토콜)의 약어

    UDP
    User Datagram Protocol(사용자 데이터그램 프로토콜)의 약어

## 3) TCP(연결형 통신)
데이터를 TCO로 전송할 떄 붙이는 헤더를 TCP 헤더라고 하고, 이 TCP 헤더가 붙은 데이터를 세그먼트라고 한다. 

데이터를 전송하기 전에 가상의 독점 통신로를 확보해야 한다. 이 연결을 확립한 후에 데이터를 전송할 수 있다.

    연결(connection)
    TCP통신에서 정보를 전달하기 위해 사용되는 가상의 통신로로 연결을 확립하고 데이터를 전송한다

TCP헤더를 보면 코드비트라고 6비트로 연결의 제어 정보가 기록되는 곳이 있다.

URG | ACK | PSH | RST | SYN | FIN

이 중 연결을 확립하려면 SYN과 ACK가 필요하다.

SYN은 연결 요청, ACK은 확인 응답을 뜻한다

### 3WAY handshake?
SYN과 ACK를 사용하여 연결을 확립할 수 있다. 신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전에 패킷을 교환하는데 

1. 컴퓨터1 --> 컴퓨터2 SYN : 연결 확립 요청
    - 통신을 하려면 컴퓨터 2에게 허가를 받아야 하므로, 먼저 컴퓨터 1에서 컴퓨터 2로 연결 확릷 허가를 받기 위한 요청을 보낸다.
2. 컴퓨터1 <-- 컴퓨터2 SYN + ACK : 연결 확립 응답 + 연결 확립 요청 
    - 컴퓨터 2는 컴퓨터 1이 보낸 요청을 받은 후에 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK)을 보낸다. 동시에 컴퓨터 2도 컴퓨터 1에게 데이터 전송 허가를 받기 위해 연결 확립 요청(SYN)을 보낸다
3. 컴퓨터1 --> 컴퓨터2 ACK : 연결 확립 응답
    - 컴퓨터 2의 요청을 받은 컴퓨터 1은 컴퓨터 2로 허가한다는 응답으로 연결 확립 응답(ACK)을 보낸다.

이처럼 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세번 교환하는 것을 3-way handshake라고 한다.

연결을 종료할때는 FIN 과 ACK를 사용한다

3-way handshake 이후 데이터를 전송할 때는 TCP 헤더의 일련번호와 확인 응답 번호가 사용된다. 

데이터를 재전송하는 것을 재전송 제어라고 한다.

수신한 세그먼트를 일시적으로 저장하는 장소를 버퍼라고 한다.

데이터 크기가 버퍼 크기를 넘어서는 것을 오버플로라고 한다.

버퍼 용량의 크기를 윈도우 크기라고 한다.

이 외에 TCP 헤더에는 출발지 포트번호와 목적지 포트번호가 있는데
이를 통해 어떤 애플리케이션에 보내는지 구분할 수 있게 되는 것이다.

포트번호는 0~65535번을 사용하는데 0~1023은 웰노운 포트, 1024번은 사용되지 않는 포트, 1025번 이상은 랜덤포트라고 부른다.

## 4) UDP(비연결형 통신)
UDP는 데이터를 효율적으로 빠르게 보내는 방식이다. 스트리밍으로 전송하는 동영상 서비스 같은 곳에 사용 된다.

### UDP 헤더란?
UDP헤더가 붙은 데이터를 UDP 데이터그램 이라고 한다.

UDP를 사용하면 같은 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있다. 이것을 브로드캐스트라고 한다.




